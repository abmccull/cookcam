#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🚀 Running pre-push checks..."

# Get the branch being pushed
branch=$(git rev-parse --abbrev-ref HEAD)

# Prevent direct push to main/master
if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then
  echo "❌ Direct push to $branch is not allowed!"
  echo "Please create a pull request instead."
  exit 1
fi

# Run tests if they exist
if [ -f "backend/api/package.json" ]; then
  if grep -q '"test"' backend/api/package.json; then
    echo "🧪 Running backend tests..."
    cd backend/api && npm test || echo "⚠️  Tests not fully implemented yet"
    cd ../..
  fi
fi

if [ -f "mobile/CookCam/package.json" ]; then
  if grep -q '"test"' mobile/CookCam/package.json; then
    echo "🧪 Running mobile tests..."
    cd mobile/CookCam && npm test || echo "⚠️  Tests not fully implemented yet"
    cd ../..
  fi
fi

echo "✅ Pre-push checks passed!"

