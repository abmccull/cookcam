#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Get the branch being pushed
branch=$(git rev-parse --abbrev-ref HEAD)

# Prevent direct push to main/master
if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then
  echo "âŒ Direct push to $branch is not allowed!"
  echo "Please create a pull request instead."
  exit 1
fi

# Run tests if they exist
if [ -f "backend/api/package.json" ]; then
  if grep -q '"test"' backend/api/package.json; then
    echo "ğŸ§ª Running backend tests..."
    cd backend/api && npm test || echo "âš ï¸  Tests not fully implemented yet"
    cd ../..
  fi
fi

if [ -f "mobile/CookCam/package.json" ]; then
  if grep -q '"test"' mobile/CookCam/package.json; then
    echo "ğŸ§ª Running mobile tests..."
    cd mobile/CookCam && npm test || echo "âš ï¸  Tests not fully implemented yet"
    cd ../..
  fi
fi

echo "âœ… Pre-push checks passed!"

