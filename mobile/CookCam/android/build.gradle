// Top-level build file where you can add configuration options common to all sub-projects/modules.

// Force suppress Kotlin version compatibility check globally
System.setProperty("suppressKotlinVersionCompatibilityCheck", "true")

buildscript {
    ext {
        minSdkVersion = 21
        compileSdkVersion = 34
        targetSdkVersion = 34

        // Use a more recent NDK version that's commonly available
        ndkVersion = "25.1.8937393"
        
        // Kotlin version updated for modern React Native compatibility
        kotlinVersion = "2.0.21"
        composeCompilerVersion = "1.5.8"
    }
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath("com.android.tools.build:gradle:8.4.1")
        classpath("com.facebook.react:react-native-gradle-plugin")
        classpath("org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion")
    }
}

allprojects {
    repositories {
        google()
        mavenCentral()
        maven { url "https://www.jitpack.io" }
        // React Native specific repositories
        maven { url("https://oss.sonatype.org/content/repositories/snapshots/") }
    }
    
    // Force specific versions to resolve compatibility issues
    configurations.all {
        resolutionStrategy {
            force "org.jetbrains.kotlin:kotlin-stdlib:$kotlinVersion"
            force "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlinVersion"
        }
    }
    
    // Global warning suppression for all modules
    tasks.withType(JavaCompile) {
        options.compilerArgs += [
            "-Xlint:-deprecation",
            "-Xlint:-unchecked",
            "-Xlint:-rawtypes",
            "-Xlint:-serial"
        ]
        options.deprecation = false
        options.warnings = false
    }
}

// Configure all subprojects to suppress Kotlin version compatibility checks
subprojects {
    afterEvaluate { project ->
        if (project.hasProperty('android')) {
            project.android {
                compileOptions {
                    sourceCompatibility JavaVersion.VERSION_17
                    targetCompatibility JavaVersion.VERSION_17
                }
                
                // Lint configuration to suppress warnings
                lintOptions {
                    checkReleaseBuilds false
                    abortOnError false
                    warningsAsErrors false
                    disable 'GradleCompatible', 'GradleDependency', 'NewerVersionAvailable'
                    disable 'TypographyFractions', 'TypographyQuotes'
                    disable 'Deprecated', 'ObsoleteLayoutParam'
                    quiet true
                }
                
                // Force Compose Compiler version for all modules
                if (project.android.hasProperty('composeOptions')) {
                    project.android.composeOptions {
                        kotlinCompilerExtensionVersion = "1.5.8"
                    }
                }
                
                // Suppress package attribute warnings in manifest files
                packagingOptions {
                    pickFirst '**/libc++_shared.so'
                    pickFirst '**/libjsc.so'
                    exclude 'META-INF/DEPENDENCIES'
                    exclude 'META-INF/LICENSE'
                    exclude 'META-INF/LICENSE.txt'
                    exclude 'META-INF/NOTICE'
                    exclude 'META-INF/NOTICE.txt'
                }
            }
        }
        
        // Force consistent JVM targets for both Java and Kotlin
        project.tasks.withType(JavaCompile).configureEach {
            sourceCompatibility = JavaVersion.VERSION_17
            targetCompatibility = JavaVersion.VERSION_17
        }
        
        // Suppress Kotlin warnings and compatibility checks
        project.tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach {
            kotlinOptions {
                jvmTarget = "17"
                // Force suppress Kotlin version compatibility check for all modules
                freeCompilerArgs += ["-Xsuppress-version-warnings"]
            }
        }
        
        // Force Compose Compiler version for modules that use Compose
        project.configurations.all {
            resolutionStrategy.eachDependency { details ->
                if (details.requested.group == 'androidx.compose.compiler' && details.requested.name == 'compiler') {
                    details.useVersion '1.5.8'
                }
            }
        }
    }
}
